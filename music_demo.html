<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <meta name="author" content=""/>
    <meta name="robots" content=""/>
    <meta name="copyright" content=""/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="apple-mobile-web-app-title" content=""/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="format-detection" content="telephone=no, email=no"/>
    <title>范冰冰定制明星养成游戏《范冰冰魔范学院》上线啦~丰富大奖等你拿哦！</title>
    <link rel="stylesheet" href="css/app.css"/>
</head>
<body ontouchmove>
<div id="loader" ontouchmove="return !1" class="loader">
    <div class="loader-graph"></div>
    <div id="progress" class="loader-progress">3%</div>
    <div class="loader-text">LOADING...</div>
</div>
<img class="share-screenshot" width="300" height="300" src="images/wx_share.jpg" alt="魔范学院"/>
<script id="tmpl" type="text/template">
    <div class="page page0">
        <div class="stage" ontouchmove="return !1">
            <div class="page0-text animate"></div>
            <div class="page0-star animate"></div>
            <div class="page0-bubble animate"></div>
            <a href="javascript:;" class="page0-btn animate" data-gotopage="2"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page1">
        <div class="stage">
            <div class="page1-ele-bar">
                <div class="page1-ele0 animate"></div>
                <div class="page1-ele1 animate"></div>
                <div class="page1-ele2 animate"></div>
                <div class="page1-ele3 animate"></div>
            </div>
            <div class="page1-text-bar">
                <div class="page1-text0 animate"></div>
                <div class="page1-text1 animate"></div>
                <div class="page1-text2 animate"></div>
                <div class="page1-text3 animate"></div>
            </div>
            <div class="page1-star animate"></div>
            <div class="page1-bubble animate"></div>
            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page2">
        <div class="stage">
            <div class="page2-light-bar">
                <div class="page2-light0 animate"></div>
                <div class="page2-light1 animate"></div>
            </div>
            <a href="" class="page2-btn" data-down="true"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page3">
        <div class="stage">
            <div class="page3-star animate"></div>
            <div class="page3-bubble animate"></div>
            <a href="#" class="page3-btn" data-down="true"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page4">
        <div class="stage">
            <div class="page4-text animate"></div>
            <div class="page4-person animate"></div>
            <div class="page4-mask"></div>
            <div class="page4-heart"></div>
            <a href="#" class="page4-btn" data-down="true"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page5">
        <div class="stage">
            <div class="page5-star animate"></div>
            <div class="page5-bubble animate"></div>
            <a href="#" class="page5-btn" data-down="true"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page6">
        <div class="stage">
            <div class="page6-flower animate"></div>
            <div class="page6-star animate"></div>
            <div class="page6-bubble animate"></div>
            <a href="#" class="page6-btn" data-down="true"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page7">
        <div class="stage">
            <div class="page7-star animate"></div>
            <div class="page7-bubble animate"></div>
            <div class="page7-plane animate"></div>
            <a href="#" class="page7-btn" data-down="true"></a>

            <div class="guide-top"></div>
        </div>
    </div>
    <div class="page page8">
        <div class="stage">
            <div class="page8-text animate"></div>
            <div id="j_packet" class="page8-packet animate"></div>
            <div class="page8-btn-bar">
                <a id="j_lottery" href="javascript:;" class="page8-lottery"></a>
                <a href="javascript:;" class="page8-share" data-share="true"></a>
                <a href="" class="page8-down" data-down="true"></a>
            </div>
            <div class="page8-rule-bar" id="j_popupBtn">
                <a href="javascript:;" class="page8-rule-btn"></a>
                <a href="javascript:;" class="page8-award-btn"></a>
            </div>
            <div class="m-popup">
                <dl>
                    <dt>礼包使用方法：</dt>
                    <dd>在进入游戏后请依次点击 右下方“菜单” → “设置” → “系统设置” → 最后点击“输入兑换码”按钮 即可弹出兑换码输入窗口。</dd>
                    <dt>电影兑换券使用流程：</dt>
                    <dd>注册/登陆格瓦拉APP→我的→票券/活动码→输入/粘贴→绑定。</dd>
                    <dt>实物奖品兑换规则：</dt>
                    <dd>抽中范冰冰同款芭比娃娃的玩家请联系QQ：2864654311，凭兑换码进行获奖确认。</dd>
                </dl>
            </div>
            <div class="m-popup">
                <dl>
                    <dt>一等奖：</dt>
                    <dd>范冰冰同款正版芭比娃娃</dd>
                    <dt>二等奖：</dt>
                    <dd>《万物生长》格瓦拉电影APP兑换券</dd>
                    <dt>三等奖：</dt>
                    <dd>《魔范学院》游戏礼包</dd>
                </dl>
            </div>
        </div>
    </div>
</script>
<script src="js/app.js"></script>
<script type="text/javascript">
    !function (undefined) {
        var PreLoad = function (source, opt) {
            var cfg = opt || {};
            this.source = source;
            this.count = 0;
            this.total = source.length;
            // 加载事件
            this.onload = cfg.onload;
            this.prefix = cfg.prefix || "";
            this.init();
        };
        PreLoad.prototype.init = function () {
            var self = this;
            self.source.forEach(function (item) {
                var type = item.substr(item.lastIndexOf(".") + 1).toLowerCase(),
                        src = self.prefix + item;
                switch (type) {
                    case"js":
                        self.script.call(self, src);
                        break;
                    case"css":
                        self.stylesheet.call(self, src);
                        break;
                    case"svg":
                    case"jpg":
                    case"gif":
                    case"png":
                    case"jpeg":
                        self.image.call(self, src);
                }
            })
        };
        PreLoad.prototype.getProgress = function () {
            return Math.round(this.count / this.total * 100)
        };
        PreLoad.prototype.image = function (src) {
            var el = document.createElement("img");
            this.load(el, src);
            el.src = src;
        };
        PreLoad.prototype.stylesheet = function (src) {
            var el = document.createElement("link");
            this.load(el, src);
            el.rel = "stylesheet";
            el.type = "text/css";
            el.href = src;
            document.head.appendChild(el);
        };
        PreLoad.prototype.script = function (src) {
            var el = document.createElement("script");
            this.load(el, src);
            el.type = "text/javascript";
            el.src = src;
            document.head.appendChild(el);
        };
        PreLoad.prototype.load = function (el, src) {
            var self = this;
            el.onload = el.onerror = el.onabort = function (event) {
                self.onload && self.onload({count: ++self.count, total: self.total, item: src, type: event.type});
            }
        };

        var tasks = ["page0_bg.jpg", "page0_btn_sprite.png", "page0_bubble.png", "page0_star.png", "page0_text.png", "page1_bg.jpg", "page1_bubble.png", "page1_ele0.png", "page1_ele1.png", "page1_ele2.png", "page1_ele3.png", "page1_star.png", "page1_text0.png", "page1_text1.png", "page1_text2.png", "page1_text3.png", "page2_bg.jpg", "page2_btn.png", "page2_light0.png", "page2_light1.png", "page3_bg.jpg", "page3_bubble.png", "page3_star.png", "page4_bg.jpg", "page4_heart_sprite.png", "page4_mask.png", "page4_person.png", "page4_text.png", "page5_bg.jpg", "page5_star.png", "page6_bg.jpg", "page6_flower.png", "page6_star.png", "page7_bg.jpg", "page7_plane.png", "page7_star.png", "page8_award_btn.png", "page8_bg.jpg", "page8_btn_down.png", "page8_btn_lottery.png", "page8_btn_share.png", "page8_packet_sprite.png", "page8_rule_btn.png", "page8_text.png", "share_arrow.png", "wx_share.jpg" ];
        var $progress = document.getElementById('progress');

        function loading(load) {
            var count = load.count;
            var total = load.total;
            $progress && ($progress.innerHTML = Math.round(100 * count / total) + '%');
            if (count === total) return complete();
        }

        function next(el, fn) {
            el.className += ' scaleOut';
            setTimeout(function () {
                el.parentNode.removeChild(el);
                fn && fn();
            }, 800);
        }

        function complete() {
            var $loader = document.getElementById('loader');
            var url = '';

            new Hi({
                music: {
                    src: 'images/music.mp3',
                    color: '#56373c',
                    loop: true,
                    autoplay: true
                }
            });

            next($loader, hiHelper);
        }

        /*****************MD5**************************/
        function MD5(a) {
            var hexcase = 0;

            function hex_md5(a) {
                if (a == "")
                    return a;
                return rstr2hex(rstr_md5(str2rstr_utf8(a)))
            };

            function hex_hmac_md5(a, b) {
                return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a), str2rstr_utf8(b)))
            }

            function md5_vm_test() {
                return hex_md5("abc").toLowerCase() == "900150983cd24fb0d6963f7d28e17f72"
            }

            function rstr_md5(a) {
                return binl2rstr(binl_md5(rstr2binl(a), a.length * 8))
            }

            function rstr_hmac_md5(c, f) {
                var e = rstr2binl(c);
                if (e.length > 16) {
                    e = binl_md5(e, c.length * 8)
                }
                var a = Array(16), d = Array(16);
                for (var b = 0; b < 16; b++) {
                    a[b] = e[b] ^ 909522486;
                    d[b] = e[b] ^ 1549556828
                }
                var g = binl_md5(a.concat(rstr2binl(f)), 512 + f.length * 8);
                return binl2rstr(binl_md5(d.concat(g), 512 + 128))
            }

            function rstr2hex(c) {
                try {
                    hexcase
                }
                catch (g) {
                    hexcase = 0
                }
                var f = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
                var b = "";
                var a;
                for (var d = 0; d < c.length; d++) {
                    a = c.charCodeAt(d);
                    b += f.charAt((a >>> 4) & 15) + f.charAt(a & 15)
                }
                return b
            }

            function str2rstr_utf8(c) {
                var b = "";
                var d = -1;
                var a, e;
                while (++d < c.length) {
                    a = c.charCodeAt(d);
                    e = d + 1 < c.length ? c.charCodeAt(d + 1) : 0;
                    if (55296 <= a && a <= 56319 && 56320 <= e && e <= 57343) {
                        a = 65536 + ((a & 1023) << 10) + (e & 1023);
                        d++
                    }
                    if (a <= 127) {
                        b += String.fromCharCode(a)
                    }
                    else {
                        if (a <= 2047) {
                            b += String.fromCharCode(192 | ((a >>> 6) & 31), 128 | (a & 63))
                        }
                        else {
                            if (a <= 65535) {
                                b += String.fromCharCode(224 | ((a >>> 12) & 15), 128 | ((a >>> 6) & 63), 128 | (a & 63))
                            }
                            else {
                                if (a <= 2097151) {
                                    b += String.fromCharCode(240 | ((a >>> 18) & 7), 128 | ((a >>> 12) & 63), 128 | ((a >>> 6) & 63), 128 | (a & 63))
                                }
                            }
                        }
                    }
                }
                return b
            }

            function rstr2binl(b) {
                var a = Array(b.length >> 2);
                for (var c = 0; c < a.length; c++) {
                    a[c] = 0
                }
                for (var c = 0; c < b.length * 8; c += 8) {
                    a[c >> 5] |= (b.charCodeAt(c / 8) & 255) << (c % 32)
                }
                return a
            }

            function binl2rstr(b) {
                var a = "";
                for (var c = 0; c < b.length * 32; c += 8) {
                    a += String.fromCharCode((b[c >> 5] >>> (c % 32)) & 255)
                }
                return a
            }

            function binl_md5(p, k) {
                p[k >> 5] |= 128 << ((k) % 32);
                p[(((k + 64) >>> 9) << 4) + 14] = k;
                var o = 1732584193;
                var n = -271733879;
                var m = -1732584194;
                var l = 271733878;
                for (var g = 0; g < p.length; g += 16) {
                    var j = o;
                    var h = n;
                    var f = m;
                    var e = l;
                    o = md5_ff(o, n, m, l, p[g + 0], 7, -680876936);
                    l = md5_ff(l, o, n, m, p[g + 1], 12, -389564586);
                    m = md5_ff(m, l, o, n, p[g + 2], 17, 606105819);
                    n = md5_ff(n, m, l, o, p[g + 3], 22, -1044525330);
                    o = md5_ff(o, n, m, l, p[g + 4], 7, -176418897);
                    l = md5_ff(l, o, n, m, p[g + 5], 12, 1200080426);
                    m = md5_ff(m, l, o, n, p[g + 6], 17, -1473231341);
                    n = md5_ff(n, m, l, o, p[g + 7], 22, -45705983);
                    o = md5_ff(o, n, m, l, p[g + 8], 7, 1770035416);
                    l = md5_ff(l, o, n, m, p[g + 9], 12, -1958414417);
                    m = md5_ff(m, l, o, n, p[g + 10], 17, -42063);
                    n = md5_ff(n, m, l, o, p[g + 11], 22, -1990404162);
                    o = md5_ff(o, n, m, l, p[g + 12], 7, 1804603682);
                    l = md5_ff(l, o, n, m, p[g + 13], 12, -40341101);
                    m = md5_ff(m, l, o, n, p[g + 14], 17, -1502002290);
                    n = md5_ff(n, m, l, o, p[g + 15], 22, 1236535329);
                    o = md5_gg(o, n, m, l, p[g + 1], 5, -165796510);
                    l = md5_gg(l, o, n, m, p[g + 6], 9, -1069501632);
                    m = md5_gg(m, l, o, n, p[g + 11], 14, 643717713);
                    n = md5_gg(n, m, l, o, p[g + 0], 20, -373897302);
                    o = md5_gg(o, n, m, l, p[g + 5], 5, -701558691);
                    l = md5_gg(l, o, n, m, p[g + 10], 9, 38016083);
                    m = md5_gg(m, l, o, n, p[g + 15], 14, -660478335);
                    n = md5_gg(n, m, l, o, p[g + 4], 20, -405537848);
                    o = md5_gg(o, n, m, l, p[g + 9], 5, 568446438);
                    l = md5_gg(l, o, n, m, p[g + 14], 9, -1019803690);
                    m = md5_gg(m, l, o, n, p[g + 3], 14, -187363961);
                    n = md5_gg(n, m, l, o, p[g + 8], 20, 1163531501);
                    o = md5_gg(o, n, m, l, p[g + 13], 5, -1444681467);
                    l = md5_gg(l, o, n, m, p[g + 2], 9, -51403784);
                    m = md5_gg(m, l, o, n, p[g + 7], 14, 1735328473);
                    n = md5_gg(n, m, l, o, p[g + 12], 20, -1926607734);
                    o = md5_hh(o, n, m, l, p[g + 5], 4, -378558);
                    l = md5_hh(l, o, n, m, p[g + 8], 11, -2022574463);
                    m = md5_hh(m, l, o, n, p[g + 11], 16, 1839030562);
                    n = md5_hh(n, m, l, o, p[g + 14], 23, -35309556);
                    o = md5_hh(o, n, m, l, p[g + 1], 4, -1530992060);
                    l = md5_hh(l, o, n, m, p[g + 4], 11, 1272893353);
                    m = md5_hh(m, l, o, n, p[g + 7], 16, -155497632);
                    n = md5_hh(n, m, l, o, p[g + 10], 23, -1094730640);
                    o = md5_hh(o, n, m, l, p[g + 13], 4, 681279174);
                    l = md5_hh(l, o, n, m, p[g + 0], 11, -358537222);
                    m = md5_hh(m, l, o, n, p[g + 3], 16, -722521979);
                    n = md5_hh(n, m, l, o, p[g + 6], 23, 76029189);
                    o = md5_hh(o, n, m, l, p[g + 9], 4, -640364487);
                    l = md5_hh(l, o, n, m, p[g + 12], 11, -421815835);
                    m = md5_hh(m, l, o, n, p[g + 15], 16, 530742520);
                    n = md5_hh(n, m, l, o, p[g + 2], 23, -995338651);
                    o = md5_ii(o, n, m, l, p[g + 0], 6, -198630844);
                    l = md5_ii(l, o, n, m, p[g + 7], 10, 1126891415);
                    m = md5_ii(m, l, o, n, p[g + 14], 15, -1416354905);
                    n = md5_ii(n, m, l, o, p[g + 5], 21, -57434055);
                    o = md5_ii(o, n, m, l, p[g + 12], 6, 1700485571);
                    l = md5_ii(l, o, n, m, p[g + 3], 10, -1894986606);
                    m = md5_ii(m, l, o, n, p[g + 10], 15, -1051523);
                    n = md5_ii(n, m, l, o, p[g + 1], 21, -2054922799);
                    o = md5_ii(o, n, m, l, p[g + 8], 6, 1873313359);
                    l = md5_ii(l, o, n, m, p[g + 15], 10, -30611744);
                    m = md5_ii(m, l, o, n, p[g + 6], 15, -1560198380);
                    n = md5_ii(n, m, l, o, p[g + 13], 21, 1309151649);
                    o = md5_ii(o, n, m, l, p[g + 4], 6, -145523070);
                    l = md5_ii(l, o, n, m, p[g + 11], 10, -1120210379);
                    m = md5_ii(m, l, o, n, p[g + 2], 15, 718787259);
                    n = md5_ii(n, m, l, o, p[g + 9], 21, -343485551);
                    o = safe_add(o, j);
                    n = safe_add(n, h);
                    m = safe_add(m, f);
                    l = safe_add(l, e)
                }
                return Array(o, n, m, l)
            }

            function md5_cmn(h, e, d, c, g, f) {
                return safe_add(bit_rol(safe_add(safe_add(e, h), safe_add(c, f)), g), d)
            }

            function md5_ff(g, f, k, j, e, i, h) {
                return md5_cmn((f & k) | ((~f) & j), g, f, e, i, h)
            }

            function md5_gg(g, f, k, j, e, i, h) {
                return md5_cmn((f & j) | (k & (~j)), g, f, e, i, h)
            }

            function md5_hh(g, f, k, j, e, i, h) {
                return md5_cmn(f ^ k ^ j, g, f, e, i, h)
            }

            function md5_ii(g, f, k, j, e, i, h) {
                return md5_cmn(k ^ (f | (~j)), g, f, e, i, h)
            }

            function safe_add(a, d) {
                var c = (a & 65535) + (d & 65535);
                var b = (a >> 16) + (d >> 16) + (c >> 16);
                return (b << 16) | (c & 65535)
            }

            function bit_rol(a, b) {
                return (a << b) | (a >>> (32 - b))
            };

            return {
                hex_md5: hex_md5
            };
        }

        //获取礼包码
        function getCodeUrl() {
            var url = "magiccode.ashx?m=get&pc=1&";
            var timestamp = Date.parse(new Date());
            var key = "uuD39Ku9M4pH9Bn1";
            url += "time=" + timestamp;
            var sign = hex_md5(timestamp + key);
            url += "&sign=" + sign;
            return url;
        }

        window.NS = window.NS || {};
        NS._util = {
            hasClass: function (obj, className) {
                return RegExp('(^|\\s)' + className + '(\\s|$)').test(obj.className);
            }
            , addClass: function (obj, newClass) {
                if (!NS._util.hasClass(obj, newClass)) {
                    obj.className += (obj.className ? ' ' : '') + newClass;
                }
            }
            , removeClass: function (obj, curClass) {
                obj.className = obj.className.replace(RegExp('(\\s|$)' + curClass, 'g'), '');
            },
            /**
             * 查找键值
             * @param name {string} 键
             * @returns {*|null}
             */
            getData: function (name) {
                var str = localStorage.getItem(name);
                var data = JSON.parse(str);
                return data || null;
            },
            /**
             * 保存数据
             * @param name {string} 键
             * @param property {string} 属性
             * @param value {string} 值
             */
            setData: function (name, property, value) {
                var storageData = this.getData(name) || {};
                storageData[property] = value;
                var str = JSON.stringify(storageData);
                localStorage.setItem(name, str);
            },
            /**
             * 清除某一键值
             * @param name {string} 键
             */
            clearData: function (name) {
                localStorage.removeItem(name);
            },
            /**
             * 获取URL的参数
             * @param name
             * @returns {*}
             */
            getQueryString: function (name) {
                var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
                var r = window.location.search.substr(1).match(reg);
                if (r != null) {
                    return decodeURIComponent(r[2]);
                }
                return null;
            }
        };

        var browser = {
            ver: function () {
                var u = navigator.userAgent;
                return {
                    mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
                    ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                    android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
                    weixin: u.indexOf('MicroMessenger') > -1 //是否微信
                };
            }()
        };

        var downUrl = !browser.ver.android ? 'javascript:alert("暂无ios下载地址");' : 'http://m.gao7.com/android/633915-20150305.html';

        var isTest = window.location.hostname == '192.168.3.58';
        if (!isTest && !browser.ver.weixin) {
            window.location.href = downUrl;
            document.body.innerHTML = '<div class="no-support-tip-main">\u8BF7\u5728\u5FAE\u4FE1\u91CC\u9762\u6D4F\u89C8</div>';
            return;
        }

        new PreLoad(tasks, {onload: loading, prefix: 'images/'});

        function hiHelper() {
            var $downBtns = document.querySelectorAll('[data-down]');
            Array.prototype.forEach.call($downBtns, function (el) {
                el.setAttribute('href', downUrl);
                el.setAttribute("onclick", "_hmt.push(['_trackEvent', 'MFXYWXdownLoad', 'download', '']);");
            });


            // var storageKey = isTest ? 'mfxy150330_test' : 'mfxy150401v1';
            var storageKey = 'mfxy150402v2';
            var hasCode = NS._util.getData(storageKey);
            if (!hasCode) {
                $.ajax({
                    type: 'GET',
                    url: isTest ? '../testAjax/demo.json' : getCodeUrl(),
                    data: '',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    timeout: 2000,
                    success: function (data) {
                        NS._util.setData(storageKey, 'ResultMessage', data['ResultMessage']);
                        NS._util.setData(storageKey, 'Data', data['Data']);
                        hasCode = data;
                    },
                    error: function (xhr, errorType, error) {
                        hasCode = {'ResultMessage': '\u83B7\u53D6\u5931\u8D25</br>\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5!'};
                        console.log(xhr, errorType, error);
                    }
                });
            }

            var $lottery = $('#j_lottery');
            var $packet = $('#j_packet');
            $lottery.one('click', function () {
                renderGameData(hasCode);
            });

            function renderGameData(data) {
                $packet.html('<p>' + data['ResultMessage'] + '</p><em>' + (data['Data'] ? data['Data'] : '') + '</em>').addClass('opened');
            }

            // 规则
            var $popupBtn = $('#j_popupBtn');
            var $popupNotes = $('.m-popup');
            $popupBtn.on('touchstart', 'a', function () {
                var $this = $(this);
                var index = $this.index();
                $($popupNotes.get(index)).removeClass('vsb').addClass('vsb');
            });
            $popupNotes.on('touchstart', function () {
                $(this).removeClass('vsb');
            });
        }
    }();
</script>
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?2e7565904b281207d572ddd32b0553e3";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.appendChild(hm);
    })();
</script>
</body>
</html>